<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üóÇÔ∏è Complete Integrated ERD - Both Stars with Genealogy</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 95%;
            margin: 0 auto;
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 30px;
        }
        .diagram-container {
            background: #ffffff;
            padding: 30px;
            margin: 30px 0;
            border-radius: 15px;
            border: 3px solid #e9ecef;
            overflow-x: auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
        }
        .mermaid {
            display: flex;
            justify-content: center;
            min-height: 600px;
        }
        .print-button {
            text-align: center;
            margin: 30px 0;
        }
        .print-button button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 10px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            transition: all 0.3s;
        }
        .print-button button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }
        @media print {
            body {
                background: white;
            }
            .print-button {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üóÇÔ∏è Complete Integrated ERD - Both Stars with Genealogy</h1>
        
        <div class="print-button">
            <button onclick="window.print()">üñ®Ô∏è Print Diagram</button>
        </div>
        
        <div class="diagram-container">
            <div class="mermaid">
erDiagram
    %% COMPLETE INTEGRATED ERD - Process + Analytical + Genealogy
    
    %% === FACTS ===
    MANUFACTURING_PROCESS_RESULTS["Manufacturing Process Results"] {
        bigint process_result_identity PK
        bigint batch_identity FK
        bigint sample_identity FK
        bigint source_material_identity FK
        bigint manufacturer_identity FK
        bigint local_process_identity FK
        bigint common_process_identity FK
        bigint specification_identity FK
        bigint notification_identity FK
        bigint document_identity FK
        bigint source_system_identity FK
        decimal yield_value
        decimal temperature_celsius
        decimal pH_value
        decimal viability_percent
        timestamp process_timestamp
    }
    
    ANALYTICAL_RESULTS["Analytical Results"] {
        bigint test_result_identity PK
        bigint batch_identity FK
        bigint sample_identity FK
        bigint source_material_identity FK
        bigint manufacturer_identity FK
        bigint test_identity FK
        bigint test_location_identity FK
        bigint analytical_method_identity FK
        bigint condition_identity FK
        bigint timepoint_identity FK
        bigint specification_identity FK
        bigint study_identity FK
        bigint notification_identity FK
        bigint document_identity FK
        bigint source_system_identity FK
        decimal test_result
        varchar result_status
        boolean oos_flag
        timestamp test_timestamp
    }
    
    BATCH_MATERIAL_USAGE["Batch Material Usage"] {
        bigint usage_identity PK
        bigint batch_identity FK
        bigint material_lot_identity FK
        bigint transformation_identity FK
        varchar usage_type
        decimal quantity_used
        timestamp usage_timestamp
    }
    
    %% === CONFORMED DIMENSIONS ===
    BATCH["Batch"] {
        bigint batch_identity PK
        varchar batch_ID UK
        varchar batch_status
        bigint parent_batch_identity FK
        varchar genealogy_type
        varchar lineage_path
        int generation_level
        bigint source_material_identity FK
        decimal batch_size
        date mfg_start_date
        varchar production_order
        boolean current_flag
    }
    
    SAMPLE["Sample"] {
        bigint sample_identity PK
        varchar sample_ID UK
        varchar vial_number
        varchar sample_type
        date collection_date
        varchar storage_location
        boolean current_flag
    }
    
    MATERIAL["Material"] {
        bigint material_identity PK
        varchar material_ID UK
        varchar material_type
        varchar material_name
        text protein_sequence
        varchar target_antigen
        varchar protein_subtype
        bigint parent_material_identity FK
        varchar lineage_path
        int hierarchy_level
        boolean current_flag
    }
    
    MANUFACTURER["Manufacturer"] {
        bigint manufacturer_identity PK
        varchar manufacturer_ID UK
        varchar manufacturer_name
        varchar manufacturer_type
        varchar facility_location
        varchar country
        boolean current_flag
    }
    
    SPECIFICATION["Specification"] {
        bigint specification_identity PK
        varchar specification_ID UK
        varchar specification_type
        varchar parameter_name
        decimal target_value
        decimal lower_limit
        decimal upper_limit
        varchar uom
        boolean current_flag
    }
    
    NOTIFICATION["Notification"] {
        bigint notification_identity PK
        varchar notification_ID UK
        varchar notification_type
        varchar event_type
        varchar severity_level
        date notification_date
    }
    
    DOCUMENT["Document"] {
        bigint document_identity PK
        varchar document_ID UK
        varchar document_type
        varchar document_name
        varchar document_url
        date upload_date
    }
    
    SOURCE_SYSTEM["Source System"] {
        bigint source_system_identity PK
        varchar source_system_ID UK
        varchar source_system_name
        varchar system_type
        varchar vendor
        boolean is_active
    }
    
    %% === PROCESS-SPECIFIC DIMENSIONS ===
    LOCAL_PROCESS_HIERARCHY["Local Process Hierarchy"] {
        bigint local_process_identity PK
        varchar process_step_ID UK
        varchar process_step_name
        bigint parent_step_identity FK
        int hierarchy_level
        boolean current_flag
    }
    
    COMMON_PROCESS_HIERARCHY["Common Process Hierarchy"] {
        bigint common_process_identity PK
        varchar common_process_ID UK
        varchar standard_process_name
        bigint parent_process_identity FK
        int hierarchy_level
        boolean current_flag
    }
    
    %% === ANALYTICAL-SPECIFIC DIMENSIONS ===
    TEST["Test"] {
        bigint test_identity PK
        varchar test_ID UK
        varchar test_name
        varchar test_category
        boolean current_flag
    }
    
    TEST_LOCATION["Test Location"] {
        bigint test_location_identity PK
        varchar location_ID UK
        varchar laboratory_name
        boolean current_flag
    }
    
    ANALYTICAL_METHOD["Analytical Method"] {
        bigint analytical_method_identity PK
        varchar method_ID UK
        varchar method_name
        varchar technique
        boolean current_flag
    }
    
    CONDITION["Condition"] {
        bigint condition_identity PK
        varchar condition_ID UK
        varchar storage_condition
        decimal temperature_celsius
        boolean current_flag
    }
    
    TIMEPOINT["Timepoint"] {
        bigint timepoint_identity PK
        varchar timepoint_ID UK
        decimal timepoint_value
        varchar timepoint_label
        boolean current_flag
    }
    
    STUDY["Study"] {
        bigint study_identity PK
        varchar study_ID UK
        varchar study_name
        varchar study_type
        boolean current_flag
    }
    
    %% === GENEALOGY DIMENSIONS ===
    MATERIAL_LOT["Material Lot"] {
        bigint material_lot_identity PK
        varchar lot_number UK
        bigint material_identity FK
        varchar lot_status
        decimal quantity
        date expiry_date
        boolean current_flag
    }
    
    TRANSFORMATION["Transformation"] {
        bigint transformation_identity PK
        varchar transformation_ID UK
        varchar transformation_type
        varchar transformation_name
        boolean current_flag
    }
    
    PRODUCTION_ORDER["Production Order"] {
        bigint production_order_identity PK
        varchar production_order_ID UK
        varchar order_type
        varchar order_status
        boolean current_flag
    }
    
    %% === BRIDGE TABLES ===
    BATCH_GENEALOGY["Batch Genealogy"] {
        bigint bridge_identity PK
        bigint child_batch_identity FK
        bigint parent_batch_identity FK
        decimal contribution_percent
        int sequence_order
    }
    
    %% === SELF-JOIN HIERARCHIES ===
    BATCH ||--o| BATCH : "parent batch of"
    MATERIAL ||--o| MATERIAL : "child component of"
    LOCAL_PROCESS_HIERARCHY ||--o| LOCAL_PROCESS_HIERARCHY : "parent operation of"
    COMMON_PROCESS_HIERARCHY ||--o| COMMON_PROCESS_HIERARCHY : "parent procedure of"

    %% === BRIDGE RELATIONSHIPS ===
    BATCH ||--o{ BATCH_GENEALOGY : "child batch in lineage"
    BATCH_GENEALOGY }o--|| BATCH : "parent batch in lineage"
    
    %% === SUPPORTING RELATIONSHIPS ===
    MATERIAL ||--o{ BATCH : "input to batch"
    MATERIAL ||--o{ MATERIAL_LOT : "instantiated as lot"
    PRODUCTION_ORDER ||--o{ BATCH : "manufactures batch"
    
    %% === PROCESS FACT RELATIONSHIPS ===
    LOCAL_PROCESS_HIERARCHY ||--o{ MANUFACTURING_PROCESS_RESULTS : "defines unit operation"
    COMMON_PROCESS_HIERARCHY ||--o{ MANUFACTURING_PROCESS_RESULTS : "defines procedure"

    MANUFACTURING_PROCESS_RESULTS }o--|| BATCH : "executed for"
    MANUFACTURING_PROCESS_RESULTS }o--|| SAMPLE : "sampled from"
    MANUFACTURING_PROCESS_RESULTS }o--|| MATERIAL : "consumed material"
    MANUFACTURING_PROCESS_RESULTS }o--|| MANUFACTURER : "executed by manufacturer"
    MANUFACTURING_PROCESS_RESULTS }o--|| SPECIFICATION : "evaluated against"
    MANUFACTURING_PROCESS_RESULTS }o--|| NOTIFICATION : "generated notification"
    MANUFACTURING_PROCESS_RESULTS }o--|| DOCUMENT : "recorded in"
    MANUFACTURING_PROCESS_RESULTS }o--|| SOURCE_SYSTEM : "originated in"
    
    %% === ANALYTICAL FACT RELATIONSHIPS ===
    BATCH ||--o{ ANALYTICAL_RESULTS : "analyzed by"
    SAMPLE ||--o{ ANALYTICAL_RESULTS : "subjected to analysis"
    MATERIAL ||--o{ ANALYTICAL_RESULTS : "material tested"
    MANUFACTURER ||--o{ ANALYTICAL_RESULTS : "produced by"
    SPECIFICATION ||--o{ ANALYTICAL_RESULTS : "compared to specification"
    NOTIFICATION ||--o{ ANALYTICAL_RESULTS : "notified via"
    DOCUMENT ||--o{ ANALYTICAL_RESULTS : "recorded in"
    SOURCE_SYSTEM ||--o{ ANALYTICAL_RESULTS : "originated in"

    ANALYTICAL_RESULTS }o--|| TEST : "executes test method"
    ANALYTICAL_RESULTS }o--|| TEST_LOCATION : "performed at location"
    ANALYTICAL_RESULTS }o--|| ANALYTICAL_METHOD : "performed by method"
    ANALYTICAL_RESULTS }o--|| CONDITION : "tested under conditions"
    ANALYTICAL_RESULTS }o--|| TIMEPOINT : "collected at timepoint"
    ANALYTICAL_RESULTS }o--|| STUDY : "conducted in study"
    
    %% === GENEALOGY FACT RELATIONSHIPS ===
    BATCH ||--o{ BATCH_MATERIAL_USAGE : "utilized in batch"
    MATERIAL_LOT ||--o{ BATCH_MATERIAL_USAGE : "consumed as lot"
    TRANSFORMATION ||--o{ BATCH_MATERIAL_USAGE : "processed by transformation"
            </div>
        </div>
    </div>
    
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                fontSize: '16px'
            }
        });
    </script>
</body>
</html>
